var av={startPage:function(b){b.save();b.transform(1,0,0,1,0,-652);b.fillStyle="rgb(125, 212, 255)";b.beginPath();b.rect(0,652,900,200);b.fill();b.strokeStyle="#3D454D";b.miterLimit=4;b.lineWidth=2;b.fillStyle="rgb(51, 102, 102)";b.font="normal bold 40px Comic Sans MS";b.strokeText("Wrecked",210,743);b.strokeText("Sailors",518,743);b.miterLimit=4;b.lineWidth=3;b.fillStyle="rgb(140, 106, 56)";b.beginPath();b.rect(0,852,900,200);b.fill();b.save();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap=
"butt";b.miterLimit=4;b.lineWidth=2;b.beginPath();b.transform(1,0,0,1,0,652);b.moveTo(0,230);b.bezierCurveTo(312,215,600,229,900,228);b.stroke();b.restore();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap="butt";b.miterLimit=4;b.lineWidth=2;b.beginPath();b.moveTo(0,920);b.bezierCurveTo(303,910,602,912,900,919);b.stroke();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap="butt";b.miterLimit=4;b.lineWidth=2;b.beginPath();b.moveTo(0,953);b.bezierCurveTo(327,945,697,959,900,952);
b.stroke();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap="butt";b.miterLimit=4;b.lineWidth=2;b.beginPath();b.moveTo(0,988);b.bezierCurveTo(296,976,599,987,900,986);b.stroke();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap="butt";b.miterLimit=4;b.lineWidth=2;b.beginPath();b.moveTo(0,1019);b.bezierCurveTo(303,1021,619,1030,900,1018);b.stroke();b.save();b.lineJoin="miter";b.strokeStyle="rgb(64, 48, 25)";b.lineCap="butt";b.miterLimit=4;b.lineWidth=3;b.beginPath();b.transform(1,
0,0,1,0,652);b.moveTo(0,200);b.bezierCurveTo(294,194,605,205,900,200);b.stroke();b.restore();for(var a=["Tutorial","Level 1","Level 2","Level 3","Level 4"],c=["","\u201ebegining\u201d","\u201echallenge\u201d","\u201edisaster\u201d","\u201eshark bay\u201d"],d=0;5>d;d++){b.strokeSyle="#403019";b.fillStyle="#eea522";b.lineWidth=1;b.beginPath();b.arc(120+165*d,945,61,0,2*Math.PI);b.stroke();b.fill();b.strokeSyle="#403019";b.fillStyle="#336666";b.lineWidth=3;b.beginPath();b.arc(120+165*d,945,40,0,2*Math.PI);
b.stroke();b.fill();b.font="18px comic sans ms";b.textBaseline="middle";b.textAlign="center";b.lineWidth=1;b.strokeSyle="#403019";b.fillStyle="#ddddff";b.fillText(a[d],120+165*d,945);b.font="12px comic sans ms";b.fillStyle="#bbbbee";b.fillText(c[d],120+165*d,963);for(var e=0;8>e;e++){var f=120+165*d+51*Math.cos(2*Math.PI/8*e),g=945+51*Math.sin(2*Math.PI/8*e);b.strokeSyle="#aa8800";b.fillStyle="#c9b74b";b.lineWidth=2;b.beginPath();b.arc(f,g,4,0,2*Math.PI);b.stroke();b.fill()}}b.beginPath();b.strokeStyle=
"rgb(235, 235, 235)";b.fillStyle="#ffffff";b.lineWidth=5;b.arc(450,730,49,0,2*Math.PI);b.fill();b.stroke();b.beginPath();b.strokeStyle="rgb(235, 235, 235)";b.fillStyle="#7dd4ff";b.lineWidth=5;b.arc(450,730,32,0,2*Math.PI);b.fill();b.stroke();b.translate(29,-40);b.fillStyle="rgb(255, 0, 0)";b.beginPath();b.moveTo(437,795);b.bezierCurveTo(444,791,445,787,448,782);b.lineTo(468,791);b.bezierCurveTo(466,799,454,811,448,814);b.closePath();b.fill();b.fillStyle="rgb(255, 0, 0)";b.beginPath();b.moveTo(407,
745);b.bezierCurveTo(400,748,398,752,395,757);b.lineTo(376,747);b.bezierCurveTo(378,739,391,727,397,725);b.closePath();b.fill();b.fillStyle="rgb(255, 0, 0)";b.beginPath();b.moveTo(449,760);b.bezierCurveTo(446,752,443,750,438,746);b.lineTo(451,729);b.bezierCurveTo(458,732,468,747,469,753);b.closePath();b.fill();b.fillStyle="rgb(255, 0, 0)";b.beginPath();b.moveTo(394,782);b.bezierCurveTo(397,789,400,791,405,795);b.lineTo(393,813);b.bezierCurveTo(385,809,375,795,374,789);b.closePath();b.fill();b.restore();
b.restore()}};av.c={PI_2:Math.PI/2,PI_3_4:3*Math.PI/4,PI_4:Math.PI/4,PI_8:Math.PI/8,PIx2:2*Math.PI,PI_180:Math.PI/180,PI_18:Math.PI/18,PIx0_75:0.75*Math.PI,PIx1_5:1.5*Math.PI};
av.util={addV:function(b,a){var c=b.v*Math.cos(b.a)+a.v*Math.cos(a.a),d=b.v*Math.sin(b.a)+a.v*Math.sin(a.a),e=Math.sqrt(c*c+d*d),c=Math.atan2(d,c);return{v:e,a:c}},subV:function(b,a){var c=b.v*Math.cos(b.a)-a.v*Math.cos(a.a),d=b.v*Math.sin(b.a)-a.v*Math.sin(a.a),e=Math.sqrt(c*c+d*d),c=Math.atan2(d,c);return{v:e,a:c}},roundRect:function(b,a,c,d,e,f,g,h){b.beginPath();b.moveTo(a+f,c);b.lineTo(a+d-f,c);b.quadraticCurveTo(a+d,c,a+d,c+f);b.lineTo(a+d,c+e-f);b.quadraticCurveTo(a+d,c+e,a+d-f,c+e);b.lineTo(a+
f,c+e);b.quadraticCurveTo(a,c+e,a,c+e-f);b.lineTo(a,c+f);b.quadraticCurveTo(a,c,a+f,c);b.closePath();h&&b.stroke();g&&b.fill()},cAdd:function(b,a){b&&!b.className.match(a)&&(b.className=b.className+" "+a)},cRem:function(b,a){b.className=(" "+b.className+" ").replace(RegExp(" "+a+" "),"").trim()},tmpl:function(b,a,c){a=a.innerHTML;var d=a.match(/(\{\{\w*\}\})/ig);if(d&&d.length&&c)for(var e=0;e<d.length;e++){var f=c[d[e].replace(/(\{\{)|(\}\})/ig,"")];a=a.replace(d[e],void 0==f||null==f?"":f)}b.innerHTML=
a}};
av.canvas={init:function(){var b=document.getElementById("myCanvas");b.height=window.innerHeight;this.h=b.height;b.width=998;this.elem=b;this.ctx=b.getContext("2d");this.bgElem=document.getElementById("background");this.bgElem.height=window.innerHeight;this.bgElem.width=998;this.bgCtx=this.bgElem.getContext("2d");this.initPatt();return{ctx:this.ctx,elem:b}},clr:function(){this.ctx.clearRect(0,0,this.elem.width,this.elem.height)},clrBg:function(){this.bgCtx.clearRect(0,0,this.elem.width,this.elem.height)},initPatt:function(){var b=
document.createElement("canvas");b.height=50;b.width=50;for(var a=b.getContext("2d"),c=a.createImageData(50,50),d=0;d<c.data.length;d+=4){var e=30*Math.random()|0;c.data[d]=114+e;c.data[d+1]=136+e;c.data[d+2]=77+e;c.data[d+3]=250}a.putImageData(c,0,0);this.pattGrass=this.ctx.createPattern(b,"repeat");for(var f=0;50>f;f+=2)for(var g=0;50>g;g+=2)d=4*(g+50*f),e=(60*Math.random()|0)-30,c.data[d]=114+e,c.data[d+1]=136+e,c.data[d+2]=77+e,c.data[d+3]=250,c.data[d+4]=114+e,c.data[d+5]=136+e,c.data[d+6]=77+
e,c.data[d+7]=250,c.data[d+200]=114+e,c.data[d+200+1]=136+e,c.data[d+200+2]=77+e,c.data[d+200+3]=250,c.data[d+200+4]=114+e,c.data[d+200+5]=136+e,c.data[d+200+6]=77+e,c.data[d+200+7]=250;a.putImageData(c,0,0);this.pattTree=this.ctx.createPattern(b,"repeat");for(f=0;50>f;f+=2)for(g=0;50>g;g+=2)d=4*(g+50*f),e=(60*Math.random()|0)-70,c.data[d]=114+e,c.data[d+1]=136+e,c.data[d+2]=77+e,c.data[d+3]=250,c.data[d+4]=114+e,c.data[d+5]=136+e,c.data[d+6]=77+e,c.data[d+7]=250,c.data[d+200]=114+e,c.data[d+200+
1]=136+e,c.data[d+200+2]=77+e,c.data[d+200+3]=250,c.data[d+200+4]=114+e,c.data[d+200+5]=136+e,c.data[d+200+6]=77+e,c.data[d+200+7]=250;a.putImageData(c,0,0);this.pattTreeDark=this.ctx.createPattern(b,"repeat")}};
av.anim={T1:0,T2:0,dT:0,cnt:0,fps:0,fpsAvg:0,calcDT:function(){this.T1=this.T2;this.T2=Date.now();this.dT=this.T2-this.T1;this.calcFps();return this.dT},calcFps:function(){this.fps+=1E3/this.dT;this.cnt++;100==this.cnt&&(this.cnt=0,this.fpsAvg=Math.round(this.fps/100),av.cockpit.values[6]=0.0078*this.fps+av.c.PIx0_75,this.fps=0)}};
av.input={x1:[],y1:[],v:0,a:0,maxV:0.2,minV:-0.03,mouse:!1,btn:[{x:120,y:120,r:45}],init:function(b){var a=this;this.elem=b;document.addEventListener("keydown",function(b){switch(b.keyCode){case 38:a.v+=0.01;a.v>a.maxV&&(a.v=a.maxV);break;case 40:a.v-=0.01;a.v<a.minV&&(a.v=a.minV);break;case 37:a.a-=0.01;a.a<-av.c.PI_8&&(a.a=-av.c.PI_8);break;case 39:a.a+=0.01;a.a>av.c.PI_8&&(a.a=av.c.PI_8);break;case 32:av.app.paused?av.app.ctrl("CONTINUE"):av.app.ctrl("PAUSE")}a.setMeter()});document.addEventListener("touchstart",
function(b){for(var d=[],e=0;e<b.targetTouches.length;e++)d[e]={x:b.targetTouches[e].pageX,y:b.targetTouches[e].pageY};a.procStart(d)});document.addEventListener("touchmove",function(b){b.preventDefault();for(var d=[],e=0;e<b.targetTouches.length;e++)d[e]={x:b.targetTouches[e].pageX,y:b.targetTouches[e].pageY};a.procMove(d)},!1);document.addEventListener("touchend",function(b){a.procEnd()});document.addEventListener("mousedown",function(b){b.preventDefault();a.mouse=!0;a.procStart([{x:b.clientX,y:b.clientY}])});
document.addEventListener("mouseup",function(b){a.mouse=!1;a.procEnd()});document.addEventListener("mousemove",function(b){b.preventDefault();if(!a.mouse)return!1;a.procMove([{x:b.clientX,y:b.clientY}])},!1);document.addEventListener("click",function(a){var b=a.target.attributes.getNamedItem("data-btn"),b=b&&b.value;switch(b){case "start":av.app.level=parseInt(a.target.attributes.getNamedItem("data-level").value);0<=av.app.level&&3>=av.app.level&&av.app.ctrl("START");break;case "tut":av.util.tmpl(document.getElementById("alert-content"),
document.getElementById("tmpl-tut"));av.util.cAdd(document.getElementById("alert"),"alert-show");break;case "continue":av.app.ctrl("CONTINUE");break;case "restart":av.app.ctrl("START");break;case "menu":av.app.ctrl("MENU")}})},procStart:function(b){for(var a=this.elem.getBoundingClientRect(),c=0;c<b.length;c++)this.x1[c]=b[c].x-a.left,this.y1[c]=b[c].y-a.top},procEnd:function(){this.elem.getBoundingClientRect();for(var b=0;b<this.x1.length;b++){var a=this.y1[b],c=av.cockpit,d=(c.r-12)*(c.r-12);Math.pow(this.x1[b]-
(c.start+c.meters.length*c.space),2)+Math.pow(a-c.y,2)<d&&av.app.ctrl("PAUSE")}this.x1=[];this.y1=[]},procMove:function(b){for(var a=this.elem.getBoundingClientRect(),c=0;c<b.length;c++){if(b.length==this.y1.length){var d=b[c].x-a.left-this.x1[c],e=this.y1[c]-(b[c].y-a.top);if(100<b[c].y-a.top){if(Math.abs(e)>Math.abs(d+d)){var f=this.v,f=f+e/500;f>this.maxV&&(f=this.maxV);f<this.minV&&(f=this.minV);this.v=f}Math.abs(d)>Math.abs(e+e)&&(e=this.a,e+=d/500,e<-av.c.PI_8&&(e=-av.c.PI_8),e>av.c.PI_8&&(e=
av.c.PI_8),this.a=e)}}this.x1[c]=b[c].x-a.left;this.y1[c]=b[c].y-a.top;this.setMeter()}},setMeter:function(){av.cockpit.values[0]=11.7*this.v+av.c.PIx0_75;av.cockpit.values[1]=4*this.a+av.c.PIx1_5}};
av.obj=function(b){this.evt="";this.evtT=2500;this.blocked=!1;this.vit=b&&b.vit||100;this.m=1;this.p1={v:200,a:av.c.PI_4};this.p=b&&b.p||{v:200,a:av.c.PI_4};this.dir=b&&b.dir||0;this.acc={v:0,a:0};this.sp=b&&b.sp||{v:0,a:0};this.move=function(a){var b={v:0,a:0};if(a&&a.drv){var b={v:a.drv.v,a:this.dir},d=this.sp.a-this.dir-av.c.PI_2,e=this.sp.v;this instanceof av.ship&&this.sp.v<av.input.v/6&&(e=av.input.v/4);this.dir+=Math.sin(d)*e*a.drv.a/-2;this.dir>Math.PI&&(this.dir-=av.c.PIx2);this.dir<-Math.PI&&
(this.dir+=av.c.PIx2)}this.dT=d=a.dT;e=a.res;a.w&&(b=av.util.addV(b,a.w));e&&(b=av.util.addV(b,{v:-this.sp.v*e,a:this.sp.a}));this.acc={v:b.v/this.m,a:b.a};this.blocked?this.sp.v=0:this.sp=av.util.addV(this.sp,{v:this.acc.v*d,a:this.acc.a});this.p1={v:this.p.v,a:this.p.a};this.p=av.util.addV(this.p1,{v:this.sp.v*d,a:this.sp.a});this.x=this.p.v*Math.cos(this.p.a);this.y=this.p.v*Math.sin(this.p.a);this.custMove()};this.custMove=function(){};this.draw=function(a){a.save();a.translate(this.x,this.y);
a.rotate(this.dir+av.c.PI_2);this.drawShape(a);a.restore()};this.drawShape=function(){};this.chkSand=function(a,b){var d=4*((a|0)+(b|0)*av.background.img.width);if(0>a||100>b||d>av.background.img.data.length-3)return!1;var e=!0;if(0==av.background.img.data[d]&&0==av.background.img.data[d+1]&&0==av.background.img.data[d+2]||av.background.img.data[d+2]>av.background.img.data[d]&&av.background.img.data[d+2]>=av.background.img.data[d+1])e=!1;return e}};
av.ship=function(b){av.obj.call(this,b);this.m=3E3;this.xOff=this.newWave=0;this.yOff=-10;this.drawShape=function(a){a.lineCap="round";a.lineWidth=2;a.strokeStyle="#999999";a.fillStyle="#917c6f";a.lineJoin="round";a.shadowColor="#032";a.shadowBlur=3;a.shadowOffsetX=3;a.shadowOffsetY=3;a.beginPath();a.arc(this.xOff+75,this.yOff+15,90,2.8797932657906435,3.695,!1);a.arc(this.xOff-75,this.yOff+15,90,5.73,0.2617993877991494,!1);a.closePath();a.fill();a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;
a.stroke();a.beginPath();a.strokeStyle="#6c5d53";a.lineWidth=1;a.moveTo(this.xOff+3,this.yOff+37);a.lineTo(this.xOff+3,this.yOff-27);a.moveTo(this.xOff-3,this.yOff+37);a.lineTo(this.xOff-3,this.yOff-27);a.moveTo(this.xOff+9,this.yOff+37);a.lineTo(this.xOff+9,this.yOff-14);a.moveTo(this.xOff-9,this.yOff+37);a.lineTo(this.xOff-9,this.yOff-14);a.stroke();a.beginPath();a.strokeStyle="#000044";a.lineWidth=2;a.moveTo(-8,-12);a.lineTo(8,-12);a.stroke();a.beginPath();a.fillStyle="#999999";av.util.roundRect(a,
-3,-34,6,6,2,!0,!1);a.shadowColor="#321";a.shadowBlur=3;a.shadowOffsetX=3;a.shadowOffsetY=3;a.beginPath();a.fillStyle="#999999";av.util.roundRect(a,-9,-12,18,28,2,!0,!1);a.fillStyle="#bbbbbb";av.util.roundRect(a,-9,6,18,11,2,!0,!1);a.beginPath();a.lineWidth=3;a.strokeStyle="#dddddd";a.moveTo(0,15);a.lineTo(-4,18);a.moveTo(0,15);a.lineTo(4,18);a.stroke();a.shadowBlur=1;a.shadowOffsetX=1;a.shadowOffsetY=1;a.beginPath();a.fillStyle="#999999";av.util.roundRect(a,-3,-34,6,6,2,!0,!1);this.msg(a)};this.custMove=
function(){av.cockpit.values[2]=40*this.sp.v+av.c.PIx0_75;var a=10+15*Math.abs(Math.cos(av.app.boat.sp.a-av.app.boat.dir));!this.blocked&&this.chkSand(this.x+a*Math.cos(av.app.boat.sp.a),this.y+a*Math.sin(av.app.boat.sp.a))&&(this.blocked=!0,av.app.ctrl("WRECKED"));this.sp.a<this.dir+av.c.PI_4&&this.sp.a>this.dir-av.c.PI_4&&(this.newWave+=this.dT,100<this.newWave&&(this.newWave=0,av.app.obj.unshift(new av.wave({sp:{v:this.sp.v/2,a:this.sp.a+av.c.PI_2},p:av.util.addV({v:this.p.v,a:this.p.a},{v:25,
a:this.dir+0.4}),vit:100})),av.app.obj.unshift(new av.wave({sp:{v:this.sp.v/2,a:this.sp.a-av.c.PI_2},p:av.util.addV({v:this.p.v,a:this.p.a},{v:25,a:this.dir-0.4}),vit:100})),av.app.obj.unshift(new av.wave({sp:{v:this.sp.v/8,a:this.sp.a+av.c.PI_2},p:av.util.addV({v:this.p.v,a:this.p.a},{v:23,a:this.dir+2.7}),vit:100})),av.app.obj.unshift(new av.wave({sp:{v:this.sp.v/8,a:this.sp.a-av.c.PI_2},p:av.util.addV({v:this.p.v,a:this.p.a},{v:23,a:this.dir-2.7}),vit:100}))));this.evt.length&&(this.evtT-=this.dT,
0>this.evtT&&(this.evt="",this.evtT=2500))};this.msg=function(a){var b="";"RSC"==this.evt&&(b="Rescured!");"HIT"==this.evt&&(b="Hit by boat!");a.font="bold 14pt Comic Sans MS";a.lineWidth=4;a.rotate(-this.dir-av.c.PI_2);a.fillStyle="#a20";a.strokeStyle="#ddf";a.textBaseline="middle";a.textAlign="center";a.strokeText(b,0,-40);a.fillText(b,0,-40)}};
av.wave=function(b){av.obj.call(this,b);this.custMove=function(){this.vit-=Math.abs(this.dT/20);0>this.vit&&(this.vit=0);80<this.vit&&(this.vit=80);this.chkSand(this.x,this.y)&&(this.vit=0)};this.drawShape=function(a){a.strokeStyle="lightblue";a.lineWidth=3;a.globalAlpha=0.2+this.vit/100;a.beginPath();a.moveTo(-1,1);a.lineTo(1,-1);a.stroke()}};
av.wrc=function(b){av.obj.call(this,b);this.health=999;this.saveT=3E3;this.m=100;this.attack=!1;this.custMove=function(){this.chkSand(this.x,this.y)&&(this.blocked=!0);this.coll&&(0.008<av.app.boat.sp.v?(this.vit=this.health=0,av.app.boat.evt="HIT",av.app.wrcLeft--,this.evtT=2500):(this.health-=this.dT,0>this.health&&(this.vit=this.health=0,av.app.boat.evt="HIT",av.app.wrcLeft--,this.evtT=2500)));this.attack&&(this.health-=this.dT,0>this.health&&(this.vit=this.health=0,av.app.wrcLeft--));this.rescure?
(this.saveT-=this.dT,0>this.saveT&&(this.vit=this.saveT=0,av.app.boat.evt="RSC",av.app.wrcLeft--,this.isRescured=!0,this.evtT=2500)):this.saveT=3E3;av.app.wrcLeft||av.app.ctrl("WRC0");var a=av.util.subV(this.p,av.app.boat.p);this.textDir=a.a;this.dist=a.v;100>this.dist&&(this.dir=a.a)};this.drawShape=function(a){a.shadowColor="#032";a.shadowBlur=3;a.shadowOffsetX=3;a.shadowOffsetY=3;a.lineCap="round";a.lineJoin="round";a.beginPath();a.lineWidth=2;a.strokeStyle="#FFDDAA";a.moveTo(-3,0);a.lineTo(-7,
3);a.lineTo(-8,6);a.moveTo(3,0);a.lineTo(7,3);a.lineTo(8,6);a.stroke();a.beginPath();a.strokeStyle="yellow";a.moveTo(4,2);a.lineTo(-4,2);a.stroke();a.fillStyle="orange";av.util.roundRect(a,-6,-4,12,5,2,!0,!1);a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.beginPath();a.arc(0,0,2.5,0,av.c.PIx2);a.fillStyle="brown";a.fill();if(100>this.dist||this.attack){var b=50*Math.cos(this.textDir),d=50*Math.sin(this.textDir);a.font="8pt Comic Sans MS";a.rotate(-this.dir-av.c.PI_2);a.fillStyle="#000";a.textBaseline=
"middle";a.textAlign="center";a.fillText("health",b,d-15);a.beginPath();a.fillStyle="#ccc";a.rect(b-25,d-5,50,5);a.fill();a.beginPath();a.fillStyle="red";a.rect(b-25,d-4,45*this.health/999,3);a.fill();this.attack||(a.fillStyle="#000",a.fillText("save time",b,d+7),a.beginPath(),a.fillStyle="#ccc",a.rect(b-25,d+17,50,5),a.fill(),a.beginPath(),a.fillStyle="red",a.rect(b-25,d+18,45*this.saveT/3E3,3),a.fill())}}};
av.shark=function(b){av.obj.call(this,b);this.baseSp=this.sp.v;this.m=200;this.target={v:500,a:0.785};this.op="seek";this.a1=this.twst=0;this.custMove=function(){"esc"!=this.op&&this.chkSand(this.x+25*Math.cos(this.sp.a),this.y+25*Math.sin(this.sp.a))&&(this.target=av.util.addV(this.p,{v:-40,a:this.sp.a}),this.op="esc");this.vict&&this.vict.isRescured&&(this.vict=null,this.op="seek");switch(this.op){case "esc":var a=av.util.subV(this.target,this.p),b=this.sp.a-a.a;b>Math.PI&&(b-=av.c.PIx2);b<-Math.PI&&
(b+=av.c.PIx2);-0.01>b&&(this.sp.a+=0.1,this.twst+=0.1);0.01<b&&(this.sp.a-=0.1,this.twst-=0.1);this.dir=this.sp.a;5>a.v&&(this.op="seek");break;case "seek":if(1050<this.x||-50>this.x||this.y>av.canvas.h+50||50>this.y)b=av.util.subV({v:450+150*Math.random(),a:av.c.PI_4},this.p),this.sp={v:this.baseSp,a:b.a},this.dir=b.a;a=500;for(b=0;b<av.coll.items.length;b++){var d=av.util.subV(av.coll.items[b].p,this.p);300>d.v&&0<av.coll.items[b].health&&0<av.coll.items[b].vit&&d.v<a&&(this.vict=av.coll.items[b],
a=d.v)}500>a&&(a=av.util.subV(this.vict.p,this.p),this.target=av.util.addV(this.vict.p,{v:50,a:a.a+av.c.PI_2}),this.op="follow");break;case "follow":a=av.util.subV(this.target,this.p);b=this.sp.a-a.a;b>Math.PI&&(b-=av.c.PIx2);b<-Math.PI&&(b+=av.c.PIx2);-0.01>b&&(this.sp.a+=0.02,this.twst+=0.1);0.01<b&&(this.sp.a-=0.02,this.twst-=0.1);this.dir=this.sp.a;3>a.v&&(this.op="circ",this.sp.v=this.baseSp+0.01);break;case "circ":if(!this.vict||1>this.vict.health){this.op="seek";b=av.util.subV({v:500,a:av.c.PI_4},
this.p);this.sp={v:this.baseSp,a:b.a};this.dir=b.a;break}a=av.util.subV(this.vict.p,this.p);this.sp.a=a.a+av.c.PI_2-0.075;this.dir=this.sp.a;this.twst-=0.5;11>a.v&&(this.sp.v=this.baseSp-0.02,this.vict.attack=!0)}4<this.twst&&(this.twst=4);-4>this.twst&&(this.twst=-4);0.03<this.twst&&(this.twst-=0.025);-0.03>this.twst&&(this.twst+=0.025)};this.drawShape=function(a){a.strokeStyle="#306060";a.fillStyle="#447777";a.beginPath();a.moveTo(-3,14);a.bezierCurveTo(-4,14,-2,13,-2,12);a.bezierCurveTo(-2,10,
-2,9,-2,7);a.bezierCurveTo(-3,6,-5,7,-7,6);a.bezierCurveTo(-9,5,-3,3,-2,2);a.bezierCurveTo(-2,1,-2,-4,-0,-5);a.bezierCurveTo(1,-4,1,1,2,2);a.bezierCurveTo(2,3,8,5,6,6);a.bezierCurveTo(5,6,2,6,2,7);a.bezierCurveTo(1,9,1,10,1,12);a.bezierCurveTo(1,13,4,13,3,14);a.bezierCurveTo(2,15,1,15,1,15);a.bezierCurveTo(0,16,0,22,-0+this.twst,25);a.bezierCurveTo(-1,21,-1,16,-1,15);a.bezierCurveTo(-1,15,-2,15,-3,14);a.closePath();a.fill();a.stroke()}};
av.coll={items:[],detect:function(){for(var b=av.util.addV(av.app.boat.p,{v:40,a:av.app.boat.dir}),a=av.util.addV(av.app.boat.p,{v:-30,a:av.app.boat.dir}),c=0;c<this.items.length;c++){var d=av.util.subV(b,this.items[c].p).v,e=av.util.subV(a,this.items[c].p).v;this.items[c].coll=75>d+e?!0:!1}b=av.util.addV(av.app.boat.p,{v:45,a:av.app.boat.dir});a=av.util.addV(av.app.boat.p,{v:-35,a:av.app.boat.dir});for(c=0;c<this.items.length;c++)d=av.util.subV(b,this.items[c].p).v,e=av.util.subV(a,this.items[c].p).v,
this.items[c].rescure=101>d+e?!0:!1},clean:function(){for(var b=0;b<this.items.length;b++)delete this.items[b];this.items=[]}};
av.cockpit={r:32,space:100,start:150,y:45,meters:[1,0,1,1,0,1],title:"Throttle;Steering;Speed;Wind speed;Wind direction;Time left".split(";"),values:[av.c.PIx0_75,av.c.PIx1_5,0,0,0,0],draw:function(b){b=b.ctx;b.save();b.lineCap="round";b.strokeStyle="#769698";b.lineWidth=4;for(var a=0;a<this.meters.length;a++)this.meters[a]?(b.beginPath(),b.moveTo(this.start+a*this.space,this.y),b.lineTo(this.start+a*this.space+(this.r-5)*Math.cos(this.values[a]),this.y+(this.r+-5)*Math.sin(this.values[a]))):(b.beginPath(),
b.moveTo(this.start+a*this.space+(this.r-8)*Math.cos(this.values[a]-av.c.PI_18),this.y+(this.r-8)*Math.sin(this.values[a]-av.c.PI_18)),b.lineTo(this.start+a*this.space+(this.r-4)*Math.cos(this.values[a]),this.y+(this.r-4)*Math.sin(this.values[a])),b.lineTo(this.start+a*this.space+(this.r-8)*Math.cos(this.values[a]+av.c.PI_18),this.y+(this.r-8)*Math.sin(this.values[a]+av.c.PI_18))),b.stroke();this.values[0]<av.c.PIx0_75-0.01&&(b.font="bold 8pt Comic Sans MS",b.fillStyle="#a02",b.textBaseline="middle",
b.textAlign="center",b.fillText("Rev",this.start,this.y+22));b.restore()}};
av.background={trees:{0:[{x:151,y:141},{x:122,y:122},{x:133,y:133}],2:[{x:105,y:75}],1:[{x:105,y:75},{x:105,y:75}]},chkSpace:function(b,a,c,d){var e=0;b|=0;a|=0;for(var f=0;f<d;f++)for(var g=0;g<c;g++){var h=4*(b+g+(f+a)*av.background.img.width);h<av.background.img.data.length-2&&(e+=av.background.img.data[h]+av.background.img.data[h+1]+av.background.img.data[h+2])}return e},draw:function(b){var a=av.canvas.bgCtx;a.save();a.fillStyle="#99cccf";a.beginPath();a.rect(0,0,998,100);a.fill();var c=av.cockpit;
a.strokeStyle="#336667";a.lineWidth=3;a.fillStyle="#76a698";a.font="10pt Comic Sans MS";a.textAlign="center";a.textBaseline="middle";for(var d=0;d<c.meters.length;d++)a.beginPath(),a.arc(c.start+d*c.space,c.y,c.r,0,av.c.PIx2,!1),a.stroke(),c.meters[d]?(a.beginPath(),a.moveTo(c.start+d*c.space+(c.r-5)*Math.cos(0.75*Math.PI),c.y+(c.r-5)*Math.sin(0.75*Math.PI)),a.lineTo(c.start+d*c.space+(c.r+5)*Math.cos(0.75*Math.PI),c.y+(c.r+5)*Math.sin(0.75*Math.PI)),a.moveTo(c.start+d*c.space+(c.r-5)*Math.cos(0.25*
Math.PI),c.y+(c.r-5)*Math.sin(0.25*Math.PI)),a.lineTo(c.start+d*c.space+(c.r+5)*Math.cos(0.25*Math.PI),c.y+(c.r+5)*Math.sin(0.25*Math.PI)),a.stroke()):(a.beginPath(),a.arc(c.start+d*c.space,c.y,c.r-12,0,av.c.PIx2,!1),a.fill()),a.fillText(c.title[d],c.start+d*c.space,c.y+c.r+10);a.beginPath();a.arc(c.start+c.meters.length*c.space,c.y,c.r-12,0,av.c.PIx2,!1);a.fill();a.stroke();a.beginPath();a.arc(c.start+c.meters.length*c.space,c.y,c.r,0,av.c.PIx2,!1);a.moveTo(c.start+c.meters.length*c.space-10,c.y-
5);a.lineTo(c.start+c.meters.length*c.space-10,c.y+5);a.moveTo(c.start+c.meters.length*c.space-5,c.y-5);a.lineTo(c.start+c.meters.length*c.space-5,c.y+5);a.stroke();a.beginPath();a.lineWidth=2;a.moveTo(c.start+c.meters.length*c.space-2,c.y+6);a.lineTo(c.start+c.meters.length*c.space+3,c.y-6);a.stroke();a.lineWidth=3;a.beginPath();a.fillStyle="#336667";a.moveTo(c.start+c.meters.length*c.space+5,c.y-5);a.lineTo(c.start+c.meters.length*c.space+5,c.y+5);a.lineTo(c.start+c.meters.length*c.space+12,c.y+
0);a.closePath();a.fill();a.translate(0,-400);av.app.levels[b].island[0]&&(a.fillStyle="rgb(153, 204, 214)",a.beginPath(),a.moveTo(365,843),a.bezierCurveTo(365,876,341,902,313,917),a.bezierCurveTo(267,941,220,914,171,897),a.bezierCurveTo(140,886,98,894,89,860),a.bezierCurveTo(77,770,189,762,251,770),a.bezierCurveTo(303,784,365,788,365,843),a.closePath(),a.fill(),a.fillStyle=av.app.sandColor,a.beginPath(),a.moveTo(341,848),a.bezierCurveTo(322,868,276,858,237,879),a.bezierCurveTo(198,900,147,878,133,
860),a.bezierCurveTo(115,812,152,793,179,788),a.bezierCurveTo(212,783,370,799,341,848),a.closePath(),a.fill(),a.fillStyle=av.canvas.pattGrass,a.beginPath(),a.moveTo(173,863),a.bezierCurveTo(140,841,163,814,172,809),a.bezierCurveTo(192,796,268,806,274,807),a.bezierCurveTo(285,811,315,823,317,834),a.bezierCurveTo(319,844,281,855,264,859),a.bezierCurveTo(249,862,195,869,173,863),a.closePath(),a.fill(),this.tree({x:180,y:820,d:0}),this.tree({x:199,y:824,d:2}),this.tree({x:215,y:840,d:1}),this.tree({x:240,
y:830,d:-2}),this.tree({x:255,y:845,d:1}),this.tree({x:265,y:820,d:-1}),this.tree({x:285,y:830,d:0}));av.app.levels[b].island[1]&&(a.fillStyle="rgb(153, 204, 214)",a.beginPath(),a.moveTo(862,920),a.bezierCurveTo(862,948,780,941,753,953),a.bezierCurveTo(706,973,705,1004,655,989),a.bezierCurveTo(624,979,593,960,585,932),a.bezierCurveTo(578,906,617,887,641,873),a.bezierCurveTo(682,848,718,846,766,854),a.bezierCurveTo(808,867,862,872,862,920),a.closePath(),a.fill(),a.fillStyle=av.app.sandColor,a.beginPath(),
a.moveTo(804,900),a.bezierCurveTo(792,927,663,971,625,931),a.bezierCurveTo(612,923,656,882,718,865),a.bezierCurveTo(766,858,805,879,804,900),a.closePath(),a.fill(),a.fillStyle=av.canvas.pattGrass,a.beginPath(),a.moveTo(713,931),a.bezierCurveTo(698,936,666,929,661,924),a.bezierCurveTo(655,917,666,901,675,896),a.bezierCurveTo(681,891,738,858,769,883),a.bezierCurveTo(800,909,728,926,713,931),a.closePath(),a.fill(),this.tree({x:700,y:890,d:0}),this.tree({x:700,y:910,d:2}),this.tree({x:725,y:890,d:-1}),
this.tree({x:745,y:890,d:-2}),this.tree({x:735,y:910,d:0}));av.app.levels[b].island[2]&&(a.fillStyle="rgb(153, 204, 214)",a.beginPath(),a.moveTo(854,780),a.bezierCurveTo(849,812,835,798,817,790),a.bezierCurveTo(788,773,776,712,724,697),a.bezierCurveTo(695,680,543,726,540,691),a.bezierCurveTo(537,661,590,622,615,609),a.bezierCurveTo(658,586,728,579,773,594),a.bezierCurveTo(809,606,828,637,843,673),a.bezierCurveTo(848,685,856,767,854,780),a.closePath(),a.fill(),a.fillStyle=av.app.sandColor,a.beginPath(),
a.moveTo(681,666),a.bezierCurveTo(665,683,599,686,584,675),a.bezierCurveTo(572,665,614,631,626,630),a.bezierCurveTo(637,625,685,645,681,666),a.closePath(),a.fill(),a.fillStyle=av.app.sandColor,a.beginPath(),a.moveTo(748,657),a.bezierCurveTo(734,656,715,650,709,635),a.bezierCurveTo(706,623,731,602,742,601),a.bezierCurveTo(759,598,792,614,801,633),a.bezierCurveTo(801,648,762,657,748,657),a.closePath(),a.fill(),a.fillStyle=av.app.sandColor,a.beginPath(),a.moveTo(839,730),a.bezierCurveTo(842,743,842,
766,835,777),a.bezierCurveTo(826,786,820,761,809,751),a.bezierCurveTo(805,744,775,728,780,710),a.bezierCurveTo(784,697,823,694,828,703),a.bezierCurveTo(832,710,837,722,839,730),a.closePath(),a.fill(),a.fillStyle=av.canvas.pattGrass,a.beginPath(),a.moveTo(832,729),a.bezierCurveTo(839,784,789,728,792,715),a.bezierCurveTo(795,706,822,704,825,710),a.bezierCurveTo(828,715,831,724,832,729),a.closePath(),a.fill(),this.tree({x:810,y:710,d:0}),this.tree({x:815,y:730,d:-1}),a.fillStyle=av.canvas.pattGrass,
a.beginPath(),a.moveTo(768,617),a.bezierCurveTo(814,649,732,647,725,637),a.bezierCurveTo(720,629,735,611,742,612),a.bezierCurveTo(748,613,763,615,768,617),a.closePath(),a.fill(),this.tree({x:740,y:620,d:0}),this.tree({x:750,y:630,d:2}),this.tree({x:765,y:630,d:-1}),a.fillStyle=av.canvas.pattGrass,a.beginPath(),a.moveTo(599,666),a.bezierCurveTo(594,658,608,646,618,643),a.bezierCurveTo(639,634,654,643,659,646),a.bezierCurveTo(677,671,615,675,599,666),a.closePath(),a.fill(),this.tree({x:610,y:650,d:0}),
this.tree({x:625,y:660,d:2}),this.tree({x:645,y:650,d:-1}));a.restore();this.img=a.getImageData(0,0,av.canvas.bgElem.width,av.canvas.bgElem.height)},tree:function(b){var a=b.x,c=b.y;b=b.d||0;var d=av.canvas.bgCtx;d.save();d.shadowColor="#032";d.shadowBlur=3;d.shadowOffsetX=3;d.shadowOffsetY=3;d.translate(a,c);d.beginPath();d.fillStyle=av.canvas.pattTreeDark;d.arc(-2,-2,5+b,0,av.c.PIx2);d.arc(3,-0,6+b,0,av.c.PIx2);d.arc(-3,3,5+b,0,av.c.PIx2);d.fill();d.beginPath();d.fillStyle=av.canvas.pattTree;d.arc(1,
1,4,0+b,av.c.PIx2);d.fill();d.restore()}};
av.app={sandColor:"#efdab5",sandVal:[239,218,181],startT:null,runT:!0,paused:!0,firstRun:30,obj:[],wind:{v:0.015,a:Math.PI},levels:[{wrc:2,shrk:1,island:[1,0,0],wind:{v:0.002,a:Math.PI}},{wrc:3,shrk:1,island:[1,1,0],wind:{v:0.007,a:1.76}},{wrc:4,shrk:1,island:[1,1,1],wind:{v:0.015,a:-1.3}},{wrc:4,shrk:4,island:[1,1,1],wind:{v:0.015,a:-0.8}}],level:0,earn:0,start:function(){console.log("start");if(!av.detect().canvas)return document.getElementById("notSupp").className="",!1;if(window.innerHeight>window.innerWidth)return av.util.cRem(document.getElementById("rotScr"),
"hide"),!1;if(1E3>window.innerWidth)return av.util.cRem(document.getElementById("smlScr"),"hide"),!1;av.util.cRem(document.getElementById("container"),"hide");av.startPage(document.getElementById("start-canvas").getContext("2d"));var b=this;window.requestAnimFrame=function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var a=av.canvas.init();
av.background.draw(this.level);av.input.init(a.elem);this.boat=new av.ship;(function d(){if(!b.paused){var e=av.anim.calcDT();if(b.firstRun)b.firstRun--;else{b.runT&&(b.timer-=e/1E3,0>b.timer&&(b.timer=0,b.runT=!1,b.ctrl("END-TIME")),av.cockpit.values[5]=0.039*b.timer+av.c.PIx0_75);av.canvas.clr();av.cockpit.draw(a);a.ctx.save();a.ctx.beginPath();a.ctx.rect(0,100,a.elem.width,a.elem.height-100);a.ctx.clip();for(var f=0;f<b.obj.length;f++){var g={dT:e,res:0,w:{v:0,a:0},drv:{v:0,a:0}};b.obj[f]instanceof
av.wrc&&(g={dT:e,res:2,w:{v:b.wind.v/2,a:b.wind.a},drv:null});b.obj[f].move(g);b.obj[f].draw(a.ctx)}g={dT:e,res:3,w:{v:b.wind.v,a:b.wind.a},drv:{v:av.input.v,a:av.input.a}};b.boat.move(g);b.boat.draw(a.ctx)}a.ctx.restore();av.coll.detect();f=b.obj.length-1;do b.obj[f]&&1>b.obj[f].vit?(delete b.obj[f],b.obj.splice(f,1)):f--;while(0<=f);av.cockpit.values[3]=100*b.wind.v+av.c.PIx0_75;av.cockpit.values[4]=b.wind.a}window.requestAnimFrame(d)})()},ctrl:function(b){switch(b){case "MENU":av.util.cRem(document.getElementById("game"),
"opa");av.util.cRem(document.getElementById("alert"),"alert-show");av.util.cAdd(document.getElementById("game"),"hide");av.util.cRem(document.getElementById("start"),"hide");av.util.cRem(document.getElementById("ftr"),"hide");break;case "START":av.canvas.clr();av.canvas.clrBg();av.background.draw(this.level);av.input.v=0;av.input.a=0;av.cockpit.values=[av.c.PIx0_75,av.c.PIx1_5,0,0,0,0];this.timer=120;this.runT=!0;this.boat.p={v:200,a:av.c.PI_4};this.boat.sp={v:0,a:0};this.boat.dir=0;this.boat.blocked=
!1;this.boat.evt="";this.paused=!1;this.firstRun=30;av.util.cRem(document.getElementById("game"),"opa");av.util.cRem(document.getElementById("alert"),"alert-show");av.util.cRem(document.getElementById("game"),"hide");av.util.cAdd(document.getElementById("start"),"hide");av.util.cAdd(document.getElementById("tut"),"hide");av.util.cAdd(document.getElementById("ftr"),"hide");b=this.levels[this.level].wind;this.wind={v:b.v,a:b.a};av.coll.clean();this.objCleanUp();for(b=0;b<this.levels[this.level].shrk;b++){var a=
new av.shark({p:{v:-100+1200*Math.random(),a:0},sp:{v:0.025+0.01*Math.random(),a:0}});av.app.obj.push(a);var c=av.util.subV({v:500,a:av.c.PI_4},a.p);a.sp.a=c.a;a.dir=c.a}for(b=0;b<this.levels[this.level].wrc;b++)a=new av.wrc({p:this.getWrcPos(),vit:100,dir:av.c.PIx2*Math.random()}),av.app.obj.push(a),av.coll.items.push(a);this.wrcLeft=av.coll.items.length;break;case "CONTINUE":av.util.cRem(document.getElementById("game"),"opa");av.util.cRem(document.getElementById("alert"),"alert-show");av.anim.T1=
Date.now();av.anim.T2=Date.now();this.paused=!1;break;case "PAUSE":av.util.cAdd(document.getElementById("game"),"opa");av.util.tmpl(document.getElementById("alert-content"),document.getElementById("tmpl-alert-pause"));av.util.cAdd(document.getElementById("alert"),"alert-show");this.paused=!0;break;case "WRECKED":this.runT=!1;av.util.cAdd(document.getElementById("game"),"opa");a=this.chkResult();a.reason="You have wrecked your boat!";av.util.tmpl(document.getElementById("alert-content"),document.getElementById("tmpl-alert"),
a);av.util.cAdd(document.getElementById("alert"),"alert-show");this.paused=!0;break;case "END-TIME":this.runT=!1;av.util.cAdd(document.getElementById("game"),"opa");a=this.chkResult();a.reason="Time is up!";av.util.tmpl(document.getElementById("alert-content"),document.getElementById("tmpl-alert"),a);av.util.cAdd(document.getElementById("alert"),"alert-show");this.paused=!0;break;case "WRC0":this.runT=!1,av.util.cAdd(document.getElementById("game"),"opa"),av.util.tmpl(document.getElementById("alert-content"),
document.getElementById("tmpl-alert"),this.chkResult()),av.util.cAdd(document.getElementById("alert"),"alert-show"),this.paused=!0}},objCleanUp:function(){for(var b=0;b<this.obj.length;b++)delete this.obj[b];this.obj=[]},chkResult:function(){for(var b=0,a=0,c=0,d=0;d<av.coll.items.length;d++)av.coll.items[d]instanceof av.wrc&&(b++,av.coll.items[d].isRescured&&(c+=av.coll.items[d].health,a++));return{all:b,rsc:a,earn:c+10*(av.app.timer+1)*a|0}},getWrcPos:function(){var b={},a=0,c=0.05*av.canvas.elem.width,
d=0.05*av.canvas.elem.height+100,e=0.9*av.canvas.elem.width,f=0.9*av.canvas.elem.height-100;do{var b=c+Math.random()*e,g=d+Math.random()*f,a=!av.background.chkSpace(b,g,32,32),b={v:Math.sqrt(b*b+g*g),a:Math.atan2(g,b)};250>av.util.subV(av.app.boat.p,b).v&&(a=0);for(g=0;g<av.coll.items.length;g++)100>av.util.subV(av.coll.items[g].p,b).v&&(a=0)}while(!a);return b}};
av.detect=function(){var b={canvas:!1},a=document.getElementById("myCanvas");a&&(b.canvas=!!(a.getContext&&a.getContext("2d")&&a.getContext("2d").fillText));return b};setTimeout(function(){av.app.start()},100);